---
title: "full_dataset_PCAngsd"
author: "Julia Harenčár"
date: "7/19/2021"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width = 7, fig.height = 5, fig.path = 'PCAngsd_figs/')
knitr::opts_knit$set(root.dir = '/Users/juliaharencar/Google Drive (jharenca@ucsc.edu)/GitHub/seq_analysis/ANGSD')
```
 This markdown summarizes the PCAs I generated by running PCAngsd on the genotype likelihood (beagle) file of all individuals combined from plates 1 and 2.
 
#### PCAs of alle, vill, and hybrids only (ANGSD_1)

PCAngsd run on beagel file from angsd1 (samtools; see 'ANGSD run tracking - full dataset' in `[g-drive]/GitHub/seq_analysis/ANGSD/angsd_runs` with estimation of independent allele frequencies.
Plot created from output of the following code:\
`pcangsd.py -beagle $IN_DIR/full_AVH.genolike.beagle.gz -o $OUT_DIR/full_AVH_1_PCAngsd`


```{r full_angsd1_AVH_PCA, echo=FALSE}
AVHpop <- read.table("angsd_out/AVH_full.pop.info")
cov <- as.matrix(read.table("angsd_out/full_AVH_1_PCAngsd.cov"))
e <- eigen(cov)

PC1 <- e$vectors[,1]
PC2 <- e$vectors[,2]
spp <- AVHpop[,2]
ID <- AVHpop[,1]
PC12.AVH.full <- data.frame(PC1, PC2, ID, spp)

library(ggplot2)
library(ggrepel)
ggplot(PC12.AVH.full, aes(x=PC1, y=PC2)) +
  geom_point(aes(color=factor(spp))) +
  geom_text_repel(aes(label=ID), size =3, nudge_y = 0.03) 
  ggtitle("AVH.full")
  
## example of how to add repelled text labels:
#library(ggrepel)
#ggplot(mtcars, aes(wt, mpg, label = rownames(mtcars))) +
#  geom_text_repel() +
#  geom_point(color = 'red') +
#  theme_classic(base_size = 16)
```
 
#### PCAs of alle, vill, hybrids, guan, and laev (ANGSD_1)

PCAngsd run on beagel file from angsd1 (samtools; see 'ANGSD run tracking - full dataset' in `[g-drive]/GitHub/seq_analysis/ANGSD/angsd_runs` with estimation of independent allele frequencies.
Plot created from output of the following code:\
`pcangsd.py -beagle $IN_DIR/full_AVHLG_genolike.beagle.gz -o $OUT_DIR/AVHLG_1_PCAngsd -threads 44`


```{r full_angsd1_AVHLG_PCA, echo=FALSE}
AVHLGpop <- read.table("angsd_out/AVHLG_full.pop.info")
cov <- as.matrix(read.table("angsd_out/AVHLG_1_PCAngsd.cov"))
e <- eigen(cov)

PC1 <- e$vectors[,1]
PC2 <- e$vectors[,2]
spp <- AVHLGpop[,2]
PC12.AVHLG.full <- data.frame(PC1, PC2, spp)

library(ggplot2)
ggplot(PC12.AVHLG.full, aes(x=PC1, y=PC2)) +
  geom_point(aes(color=factor(spp))) +
  ggtitle("AVHLG.full")
  

#labeling code to check out:
#ggplot(tab, aes(x = EV2, y = EV1, col = pop)) +
#  geom_point(alpha = 0.5, size = 5) +
#  # geom_text(aes(label=sample.id), size =3, hjust = 0, nudge_x = 0.02) +
#  # geom_text(aes(label=sample.id), size =3, position=position_jitter(width=0.2,height=0,2)) +
#  geom_text_repel(aes(label=sample.id), size =3, nudge_y = 0.03) +
#  theme_bw()
```



### Admixture plot of plate 2 alle, vill, and hybrids only

Plot created from output of the following code:\
`NGSadmix -likes $IN_DIR/p2_AVH.genolike.beagle.gz -K 2 -P 48 -o $OUT_DIR/AVH_p2_NGSadmix_out -minMaf 0.05`

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.path = 'NGSadmix_figs/')
knitr::opts_knit$set(root.dir = '/Users/juliaharencar/Google Drive (jharenca@ucsc.edu)/Costus/Seq_analysis/ANGSD')
```
```{r p2_angsd1_AVH_admixture, fig.width = 10, fig.height = 5, echo=FALSE}

# Get ID and pop info for each individual
pop<-scan("angsd_out/AVH_p2.poplabel", what="type")

# Read inferred admixture proportions file
q<-read.table("angsd_out/NGSadmix/AVH_p2_NGSadmix_out.qopt")

# Plot them (ordered by population)
ord = order(pop)
par(mar=c(7,4,1,1))
barplot(t(q)[,ord],col=c("red","yellow"),names=pop[ord],las=2,ylab="AVH Admixture proportions",cex.names=0.75)
#quartz.save("NGSadmix_figs/AVH_only_admixture_plot", type="png")

```

